{% extends "base.html" %}

{% block title %}AI Recipe Suggestions - SmartPantry{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="text-primary mb-2">
                        <i class="bi bi-magic me-2"></i>AI Recipe Suggestions
                    </h2>
                    <p class="text-muted mb-0">Recipes generated based on your pantry items</p>
                </div>
                <div class="text-end">
                    <span class="badge bg-primary fs-6">{{ pantry_items|length }} items in pantry</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Pantry Items Used -->
    {% if pantry_items %}
    <div class="alert alert-info mb-4">
        <h6 class="mb-2"><i class="bi bi-box-seam me-2"></i>Using these pantry items:</h6>
        <div class="d-flex flex-wrap gap-2">
            {% for item in pantry_items %}
            <span class="badge bg-light text-dark">{{ item }}</span>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if recipes %}
        <div class="row">
            {% for recipe in recipes %}
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card shadow-sm border-0 h-100">
                        <div class="card-header bg-gradient-primary text-white border-0">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">{{ recipe.name }}</h5>
                                <div class="text-end">
                                    {% if recipe.health_rating %}
                                        {% if recipe.health_rating == "Healthy" %}
                                        <span class="badge bg-success text-white mb-1">
                                            <i class="bi bi-heart-fill me-1"></i>{{ recipe.health_rating }}
                                        </span>
                                        {% elif recipe.health_rating == "Moderately Healthy" %}
                                        <span class="badge bg-warning text-dark mb-1">
                                            <i class="bi bi-heart me-1"></i>{{ recipe.health_rating }}
                                        </span>
                                        {% else %}
                                        <span class="badge bg-danger text-white mb-1">
                                            <i class="bi bi-exclamation-triangle me-1"></i>{{ recipe.health_rating }}
                                        </span>
                                        {% endif %}
                                    {% endif %}
                                    {% if recipe.difficulty %}
                                    <br><span class="badge bg-light text-dark">{{ recipe.difficulty }}</span>
                                    {% endif %}
                                    {% if recipe.cooking_time %}
                                    <br><small class="opacity-75">{{ recipe.cooking_time }}</small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h6 class="text-primary mb-3">
                                <i class="bi bi-list-ul me-2"></i>Ingredients
                            </h6>
                            <div class="mb-4">
                                {% for ing in recipe.ingredients %}
                                    {% if pantry_items and ing in pantry_items %}
                                    <span class="badge bg-success text-white me-2 mb-2">
                                        <i class="bi bi-check-circle me-1"></i>{{ ing }}
                                    </span>
                                    {% else %}
                                    <span class="badge bg-light text-dark me-2 mb-2">{{ ing }}</span>
                                    {% endif %}
                                {% endfor %}
                                <div class="mt-2">
                                    <small class="text-muted">
                                        <i class="bi bi-info-circle me-1"></i>
                                        Green badges are from your pantry
                                    </small>
                                </div>
                            </div>

                            <h6 class="text-primary mb-3">
                                <i class="bi bi-list-ol me-2"></i>Instructions
                            </h6>
                            <ol class="mb-4">
                                {% for step in recipe.instructions %}
                                <li class="mb-2">{{ step }}</li>
                                {% endfor %}
                            </ol>

                            <!-- Health Assessment -->
                            {% if recipe.health_rating and recipe.health_explanation %}
                            <div class="alert alert-info mb-4">
                                <div class="d-flex align-items-start">
                                    {% if recipe.health_rating == "Healthy" %}
                                    <i class="bi bi-heart-fill text-success fs-4 me-3 mt-1"></i>
                                    {% elif recipe.health_rating == "Moderately Healthy" %}
                                    <i class="bi bi-heart text-warning fs-4 me-3 mt-1"></i>
                                    {% else %}
                                    <i class="bi bi-exclamation-triangle text-danger fs-4 me-3 mt-1"></i>
                                    {% endif %}
                                    <div>
                                        <h6 class="mb-1">
                                            {% if recipe.health_rating == "Healthy" %}
                                            <span class="text-success fw-bold">{{ recipe.health_rating }}</span>
                                            {% elif recipe.health_rating == "Moderately Healthy" %}
                                            <span class="text-warning fw-bold">{{ recipe.health_rating }}</span>
                                            {% else %}
                                            <span class="text-danger fw-bold">{{ recipe.health_rating }}</span>
                                            {% endif %}
                                        </h6>
                                        <small class="text-muted">{{ recipe.health_explanation }}</small>
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Nutrition Info -->
                            {% if recipe.nutrition %}
                            <div class="card bg-light border-0 mb-3">
                                <div class="card-header bg-gradient-success text-white border-0">
                                    <h6 class="mb-0"><i class="bi bi-bar-chart me-2"></i>Nutrition Facts</h6>
                                </div>
                                <div class="card-body">
                                    <table class="table table-sm table-bordered mb-0">
                                        <tr><th>Calories</th><td>{{ recipe.nutrition.calories }}</td></tr>
                                        <tr><th>Carbs</th><td>{{ recipe.nutrition.carbs }} g</td></tr>
                                        <tr><th>Protein</th><td>{{ recipe.nutrition.protein }} g</td></tr>
                                        <tr><th>Fat</th><td>{{ recipe.nutrition.fat }} g</td></tr>
                                        <tr><th>Fiber</th><td>{{ recipe.nutrition.fiber }} g</td></tr>
                                    </table>
                                </div>
                            </div>
                            <div class="text-center">
                                <a href="{{ url_for('recipe_detail', recipe_name=recipe.name) }}" 
                                   class="btn btn-success btn-sm">
                                    <i class="bi bi-book me-2"></i>Learn More About This Recipe
                                </a>
                            </div>
                            {% else %}
                            <div class="text-center">
                                <a href="{{ url_for('recipe_detail', recipe_name=recipe.name) }}" 
                                   class="btn btn-success btn-sm">
                                    <i class="bi bi-book me-2"></i>Learn More About This Recipe
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-warning text-center">
            <i class="bi bi-exclamation-circle me-2"></i> 
            No recipes could be generated with your pantry items. Try adding more ingredients!
        </div>
    {% endif %}

    <!-- Action Buttons -->
    <div class="row mt-4">
        <div class="col-12 text-center">
            <a href="{{ url_for('generate_new_recipes') }}" class="btn btn-primary me-3">
                <i class="bi bi-arrow-clockwise me-2"></i>Generate New Recipes
            </a>
            <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                <i class="bi bi-house me-2"></i>Back to Pantry
            </a>
        </div>
    </div>
</div>

<style>
@media print {
    /* Hide interactive elements */
    .btn, .alert, .breadcrumb {
        display: none !important;
    }
    
    /* Print-friendly layout */
    body {
        font-size: 11pt !important;
        line-height: 1.3 !important;
        color: #000 !important;
        background: white !important;
    }
    
    .container {
        max-width: none !important;
        padding: 0 !important;
        margin: 0 !important;
    }
    
    /* Recipe cards */
    .card {
        border: 2px solid #000 !important;
        box-shadow: none !important;
        margin-bottom: 20pt !important;
        page-break-inside: avoid !important;
        width: 100% !important;
    }
    
    .card-header {
        background: #f8f9fa !important;
        color: #000 !important;
        border-bottom: 2px solid #000 !important;
        padding: 10pt !important;
    }
    
    .card-header h5 {
        font-size: 14pt !important;
        margin: 0 !important;
        font-weight: bold !important;
    }
    
    .card-header .badge {
        background: #e9ecef !important;
        color: #000 !important;
        border: 1px solid #000 !important;
        font-size: 9pt !important;
        margin: 1pt !important;
    }
    
    .card-body {
        padding: 12pt !important;
    }
    
    /* Ingredients */
    .badge {
        background: #f8f9fa !important;
        color: #000 !important;
        border: 1px solid #000 !important;
        font-size: 9pt !important;
        margin: 1pt !important;
        display: inline-block !important;
    }
    
    /* Instructions */
    ol {
        margin: 8pt 0 !important;
    }
    
    li {
        margin-bottom: 4pt !important;
    }
    
    /* Health assessment */
    .alert-info {
        border: 1px solid #000 !important;
        background: #f8f9fa !important;
        margin: 8pt 0 !important;
        padding: 8pt !important;
    }
    
    /* Nutrition table */
    .table {
        font-size: 9pt !important;
        margin: 8pt 0 !important;
    }
    
    .table th, .table td {
        border: 1px solid #000 !important;
        padding: 3pt !important;
    }
    
    .table th {
        background: #f8f9fa !important;
        font-weight: bold !important;
    }
    
    /* Remove gradients and colors */
    .bg-gradient-primary, .bg-gradient-success, .bg-gradient-info, .bg-gradient-warning {
        background: #f8f9fa !important;
        color: #000 !important;
    }
    
    /* Page breaks */
    .card {
        page-break-inside: avoid !important;
    }
    
    h1, h2, h3, h4, h5, h6 {
        page-break-after: avoid !important;
    }
    
    /* Print header */
    @page {
        margin: 0.75in;
        @top-center {
            content: "SmartPantry Recipes";
        }
    }
    
    /* Two-column layout for recipes */
    .row .col-lg-4 {
        width: 48% !important;
        float: left !important;
        margin-right: 4% !important;
    }
    
    .row .col-lg-4:nth-child(even) {
        margin-right: 0 !important;
    }
}
</style>

{% endblock %}
